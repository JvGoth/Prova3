<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Interativo de Imunologia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .section {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
        }
        .question {
            margin-bottom: 20px;
        }
        .question p {
            font-weight: bold;
        }
        .options {
            display: flex;
            flex-direction: column;
        }
        .option {
            background-color: #e7e7e7;
            border: none;
            border-radius: 4px;
            color: #333;
            cursor: pointer;
            margin: 5px 0;
            padding: 10px;
            text-align: left;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #d0d0d0;
        }
        .option.selected {
            background-color: #3498db;
            color: #fff;
        }
        .open-answer {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 5px 0;
            font-family: Arial, sans-serif;
        }
        .submit-btn {
            background-color: #27ae60;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            display: block;
            font-size: 16px;
            margin: 20px auto 0;
            padding: 10px 20px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #219653;
        }
        .feedback {
            margin-top: 20px;
            text-align: center;
        }
        .correct {
            color: #27ae60;
        }
        .incorrect {
            color: #e74c3c;
        }
        .result {
            background-color: #ecf0f1;
            border-radius: 4px;
            margin-top: 20px;
            padding: 10px;
        }
        .result ul {
            list-style-type: none;
            padding: 0;
        }
        .result li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Quiz Interativo de Imunologia</h1>
    <p style="text-align: center;">Este site contém questões interativas sobre Imunologia, baseadas nos slides fornecidos. Selecione 5 respostas por seção e clique em "Verificar". A seção final contém 20 questões abertas.</p>

    <div class="section" id="section1">
        <h2>Funções do SI e Imunidade Inata vs Adaptativa</h2>
        <div id="questions1"></div>
        <button class="submit-btn" onclick="checkAnswers('section1')">Verificar Respostas</button>
        <div class="feedback" id="feedback1"></div>
        <div class="result" id="result1" style="display: none;"></div>
    </div>

    <div class="section" id="section2">
        <h2>Células e Órgãos do Sistema Imune</h2>
        <div id="questions2"></div>
        <button class="submit-btn" onclick="checkAnswers('section2')">Verificar Respostas</button>
        <div class="feedback" id="feedback2"></div>
        <div class="result" id="result2" style="display: none;"></div>
    </div>

    <div class="section" id="section3">
        <h2>Definição, Tipos e Epítopos de Antígenos</h2>
        <div id="questions3"></div>
        <button class="submit-btn" onclick="checkAnswers('section3')">Verificar Respostas</button>
        <div class="feedback" id="feedback3"></div>
        <div class="result" id="result3" style="display: none;"></div>
    </div>

    <div class="section" id="section4">
        <h2>Antigenicidade, Imunogenicidade e Fatores</h2>
        <div id="questions4"></div>
        <button class="submit-btn" onclick="checkAnswers('section4')">Verificar Respostas</button>
        <div class="feedback" id="feedback4"></div>
        <div class="result" id="result4" style="display: none;"></div>
    </div>

    <div class="section" id="section5">
        <h2>Anticorpos, Haptenos, Superantígenos e Mecanismos</h2>
        <div id="questions5"></div>
        <button class="submit-btn" onclick="checkAnswers('section5')">Verificar Respostas</button>
        <div class="feedback" id="feedback5"></div>
        <div class="result" id="result5" style="display: none;"></div>
    </div>

    <div class="section" id="section6">
        <h2>Questões Abertas (Nível Avançado)</h2>
        <p>Responda livremente nas caixas de texto. Verificação parcial baseada em palavras-chave.</p>
        <div id="questions6"></div>
        <button class="submit-btn" onclick="checkAnswers('section6')">Verificar Respostas</button>
        <div class="feedback" id="feedback6"></div>
        <div class="result" id="result6" style="display: none;"></div>
    </div>

    <script>
        // Função para embaralhar array (Fisher-Yates shuffle)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Pools de Perguntas de Imunologia (Baseadas nos PDFs)
        const questionPools = {
            section1: [
                { type: 'mc', q: "Qual das seguintes NÃO é uma função principal do Sistema Imune listada nos slides?", options: ["A: Resistência às infecções [cite: 251]", "B: Tolerância ao próprio [cite: 252]", "C: Controle de Tumores [cite: 266]", "D: Digestão de nutrientes"], correct: "D" },
                { type: 'mc', q: "A imunidade inata é caracterizada por ser:", options: ["A: Específica e com memória [cite: 300, 332]", "B: Constitutiva, imediata e rápida [cite: 326]", "C: Lenta e dependente de expansão clonal [cite: 227]", "D: Mediada apenas por anticorpos [cite: 339, 342]"], correct: "B" },
                { type: 'mc', q: "A resposta imune adaptativa possui quais propriedades principais?", options: ["A: Especificidade e memória [cite: 332, 333, 335]", "B: Apenas inflamação e defesa antiviral [cite: 331]", "C: Ausência de diversidade (amplo espectro) [cite: 333]", "D: É sempre imediata e rápida [cite: 313]"], correct: "A" },
                { type: 'mc', q: "A imunidade humoral é mediada principalmente por:", options: ["A: Linfócitos T em cooperação [cite: 338, 340]", "B: Linfócitos B e Anticorpos [cite: 339, 341, 342]", "C: Fagócitos inatos [cite: 304]", "D: Barreiras epiteliais [cite: 301]"], correct: "B" },
                { type: 'mc', q: "Receber anticorpos da mãe durante a gestação e lactação é um exemplo de:", options: ["A: Imunidade ativa natural [cite: 358]", "B: Imunidade ativa artificial [cite: 359]", "C: Imunidade passiva natural [cite: 361]", "D: Imunidade passiva artificial [cite: 362]"], correct: "C" },
                { type: 'mc', q: "A vacinação (imunização) é um exemplo de:", options: ["A: Imunidade passiva artificial [cite: 362]", "B: Imunidade ativa artificial [cite: 359]", "C: Imunidade ativa natural [cite: 358]", "D: Imunidade inata [cite: 299]"], correct: "B" },
                { type: 'mc', q: "A resposta imune celular é mediada por:", options: ["A: Linfócitos T em cooperação com outras células [cite: 338, 340]", "B: Apenas anticorpos [cite: 339]", "C: Sistema complemento [cite: 311]", "D: Basófilos e Mastócitos [cite: 308]"], correct: "A" },
                { type: 'mc', q: "Qual a principal diferença entre a resposta primária e secundária?", options: ["A: A secundária é mais lenta e fraca", "B: A primária usa células inatas, a secundária não", "C: A secundária é mais rápida e intensa devido à memória [cite: 335, 347]", "D: A primária não produz anticorpos"], correct: "C" },
                { type: 'mc', q: "Fatores como idade, estresse e nutrição podem influenciar:", options: ["A: A resposta imune à vacinação [cite: 272, 273, 280, 284]", "B: Apenas a imunidade inata [cite: 272]", "C: Apenas a cor das células", "D: Somente a imunidade passiva [cite: 360]"], correct: "A" },
                { type: 'mc', q: "As principais reações protetoras da imunidade inata são:", options: ["A: Memória e especificidade [cite: 333, 335]", "B: Inflamação e Defesa antiviral [cite: 331]", "C: Apenas expansão clonal [cite: 227]", "D: Produção de IgA e IgG [cite: 187]"], correct: "B" }
            ],
            section2: [
                { type: 'mc', q: "Qual célula é considerada a principal APC (Célula Apresentadora de Antígenos)?", options: ["A: Célula dendrítica [cite: 407]", "B: Neutrófilo [cite: 408]", "C: Eritrócito", "D: Plaquetas"], correct: "A" },
                { type: 'mc', q: "Linfócitos T CD4+ são também conhecidos como:", options: ["A: Helpers/Auxiliares [cite: 351, 398]", "B: Citotóxicos/Citolíticos [cite: 351, 398]", "C: Reguladores [cite: 351, 398]", "D: Natural Killers (NK) [cite: 403]"], correct: "A" },
                { type: 'mc', q: "Quais são os órgãos linfoides primários (centrais) onde os linfócitos maduram?", options: ["A: Linfonodos e Baço [cite: 413]", "B: Medula óssea e Timo [cite: 413]", "C: Fígado e Rins", "D: MALT e GALT [cite: 413, 446]"], correct: "B" },
                { type: 'mc', q: "O Baço é um órgão secundário que filtra antígenos primariamente da:", options: ["A: Circulação sanguínea [cite: 436]", "B: Circulação linfática [cite: 431]", "C: Mucosa intestinal [cite: 446]", "D: Pele [cite: 446]"], correct: "A" },
                { type: 'mc', q: "Linfócitos NK (Natural Killer) são mediadores da imunidade:", options: ["A: Inata, contra vírus e tumores [cite: 403]", "B: Adaptativa humoral [cite: 339]", "C: Adaptativa celular [cite: 338]", "D: Passiva artificial [cite: 362]"], correct: "A" },
                { type: 'mc', q: "O Timo é o sítio de maturação principal de qual célula?", options: ["A: Linfócitos B [cite: 419]", "B: Linfócitos T [cite: 413, 396]", "C: Macrófagos [cite: 378]", "D: Neutrófilos [cite: 408]"], correct: "B" },
                { type: 'mc', q: "A Medula Óssea é o sítio de maturação principal de qual célula?", options: ["A: Linfócitos B [cite: 419, 396]", "B: Linfócitos T [cite: 413]", "C: Apenas Células T CD4+", "D: Células dendríticas maduras [cite: 389]"], correct: "A" },
                { type: 'mc', q: "Qual granulócito está primariamente envolvido na fagocitose de bactérias?", options: ["A: Eosinófilos [cite: 408]", "B: Basófilos [cite: 408]", "C: Neutrófilos [cite: 408]", "D: Mastócitos [cite: 408]"], correct: "C" },
                { type: 'mc', q: "Qual granulócito está envolvido na defesa contra parasitas e em alergias?", options: ["A: Eosinófilos [cite: 408]", "B: Neutrófilos [cite: 408]", "C: Monócitos [cite: 373]", "D: Linfócitos T"], correct: "A" },
                { type: 'mc', q: "Linfonodos, Baço e MALT (Tecido Linfoide Associado à Mucosa) são classificados como:", options: ["A: Órgãos primários [cite: 413]", "B: Órgãos secundários (periféricos) [cite: 413]", "C: Barreiras epiteliais [cite: 301]", "D: Sítios de hematopoiese [cite: 416]"], correct: "B" }
            ],
            section3: [
                { type: 'mc', q: "De acordo com a definição nos slides, um Antígeno (Ag) é qualquer substância que pode ligar especificamente a um:", options: ["A: Anticorpo (BCR) ou Receptor de Célula T (TCR) [cite: 95, 97, 98]", "B: Apenas receptores da imunidade inata [cite: 99]", "C: Apenas ao Sistema Complemento [cite: 311]", "D: Apenas a moléculas de MHC"], correct: "A" },
                { type: 'mc', q: "Antígenos próprios do organismo, que normalmente são tolerados, são chamados de:", options: ["A: Antígenos estranhos [cite: 88]", "B: Haptenos [cite: 162]", "C: Autoantígenos [cite: 93]", "D: Superantígenos [cite: 166]"], correct: "C" },
                { type: 'mc', q: "A região específica no antígeno que é reconhecida pelo anticorpo ou TCR é chamada de:", options: ["A: Epítopo (ou Determinante Antigênico) [cite: 135, 137]", "B: Paratopo", "C: Imunógeno [cite: 140]", "D: Adjuvante [cite: 159]"], correct: "A" },
                { type: 'mc', q: "Um epítopo que é perdido quando a proteína sofre desnaturação (perde a estrutura 3D) é um:", options: ["A: Determinante linear [cite: 138, 27]", "B: Determinante conformacional [cite: 138, 21, 46]", "C: Neoantígeno [cite: 138, 30]", "D: Hapteno [cite: 162]"], correct: "B" },
                { type: 'mc', q: "Qual classe de molécula é listada como a mais imunogênica (Proteínas > ...)?", options: ["A: Ácidos nucleicos [cite: 1]", "B: Lipídeos [cite: 1]", "C: Polissacarídeos [cite: 1]", "D: Proteínas [cite: 1]"], correct: "D" },
                { type: 'mc', q: "Patógenos, microbiota, alimentos e antígenos ambientais são classificados como:", options: ["A: Antígenos estranhos [cite: 88, 89, 90, 91, 92]", "B: Autoantígenos [cite: 93]", "C: Epítopos lineares [cite: 27]", "D: Antígenos neoantigênicos [cite: 30]"], correct: "A" },
                { type: 'mc', q: "A falha na tolerância a autoantígenos pode levar a:", options: ["A: Doenças autoimunes [cite: 133, 134]", "B: Imunidade passiva [cite: 360]", "C: Resposta inata [cite: 299]", "D: Uma resposta secundária mais forte [cite: 347]"], correct: "A" },
                { type: 'mc', q: "Um determinante linear é reconhecido pela sua sequência de aminoácidos, independentemente da:", options: ["A: Carga elétrica", "B: Estrutura 3D (conformação) [cite: 138, 27, 43]", "C: Ligação ao TCR [cite: 98]", "D: Presença de adjuvante [cite: 159]"], correct: "B" },
                { type: 'mc', q: "Por que os receptores da imunidade inata não são inclusos na definição clássica de Antígeno?", options: ["A: Porque eles não ligam substâncias", "B: Porque eles não são específicos como BCR e TCR [cite: 99]", "C: Porque eles induzem memória [cite: 299]", "D: Porque eles são solúveis"], correct: "B" }
            ],
            section4: [
                { type: 'mc', q: "Qual é a definição de Antigenicidade?", options: ["A: Habilidade de induzir resposta imune [cite: 140]", "B: Habilidade de se combinar com Anticorpos ou TCR [cite: 140]", "C: Habilidade de ativar T policlonalmente [cite: 167]", "D: Habilidade de precisar de um carreador [cite: 163]"], correct: "B" },
                { type: 'mc', q: "Qual é a definição de Imunogenicidade?", options: ["A: Apenas a habilidade de se ligar a um anticorpo [cite: 140]", "B: Habilidade de ligar E induzir uma resposta imune [cite: 140]", "C: Ser um antígeno de baixo peso molecular [cite: 162]", "D: Ser um autoantígeno [cite: 93]"], correct: "B" },
                { type: 'mc', q: "Complete a frase: 'Todos os imunógenos são antígenos, mas nem todos os antígenos são...'", options: ["A: Imunógenos [cite: 141]", "B: Epítopos [cite: 137]", "C: Proteínas [cite: 1]", "D: Autoantígenos [cite: 93]"], correct: "A" },
                { type: 'mc', q: "Qual faixa de massa molecular (MM) é considerada ideal para bons imunógenos?", options: ["A: < 5.000 Da [cite: 148]", "B: ~ 100.000 Da [cite: 148]", "C: > 1.000.000 Da", "D: A MM não influencia a imunogenicidade [cite: 147]"], correct: "B" },
                { type: 'mc', q: "Qual fator NÃO é listado como influenciador da imunogenicidade?", options: ["A: Genótipo do indivíduo [cite: 143]", "B: Dose e via de administração [cite: 144]", "C: Uso de Adjuvantes [cite: 145]", "D: Cor do antígeno"], correct: "D" },
                { type: 'mc', q: "A administração de um antígeno pela via endovenosa (EV) tende a levá-lo para qual órgão, favorecendo a resposta celular?", options: ["A: Linfonodos [cite: 155]", "B: Baço [cite: 156]", "C: Placas de Peyer (via oral) [cite: 155, 157]", "D: Timo [cite: 413]"], correct: "B" },
                { type: 'mc', q: "Adjuvantes são substâncias que aumentam a imunogenicidade. Qual NÃO é um efeito geral dos adjuvantes?", options: ["A: Prolongam a persistência do Ag [cite: 160]", "B: Aumentam a inflamação local [cite: 160]", "C: Aumentam moléculas coestimuladoras [cite: 160]", "D: Induzem tolerância específica (Treg)"], correct: "D" },
                { type: 'mc', q: "Moléculas com < 5.000 a 10.000 Da são geralmente:", options: ["A: Pobres imunógenos [cite: 148]", "B: Excelentes imunógenos [cite: 148]", "C: Superantígenos [cite: 166]", "D: Adjuvantes [cite: 159]"], correct: "A" },
                { type: 'mc', q: "Quanto maior a distância filogenética entre a fonte do Ag e o indivíduo, a imunogenicidade tende a ser:", options: ["A: Menor [cite: 152]", "B: Maior [cite: 151, 152]", "C: Irrelevante", "D: Dependente da dose apenas [cite: 153]"], correct: "B" },
                { type: 'mc', q: "Doses muito altas de um antígeno podem levar à:", options: ["A: Tolerância [cite: 153]", "B: Uma resposta primária mais rápida", "C: Imunidade passiva [cite: 360]", "D: Formação de haptenos [cite: 161]"], correct: "A" }
            ],
            section5: [
                { type: 'mc', q: "Haptenos são antígenos de baixo peso molecular que:", options: ["A: São altamente imunogênicos sozinhos [cite: 162]", "B: Não são imunogênicos sozinhos, mas se tornam ao ligar-se a um carreador [cite: 162, 163]", "C: Ativam células T policlonalmente [cite: 167]", "D: São sempre proteínas [cite: 164]"], correct: "B" },
                { type: 'mc', q: "Superantígenos (como toxinas de Staphylococcus) ativam inespecificamente:", options: ["A: Uma grande fração de clones de células T (até 25%) [cite: 167]", "B: Apenas células B (resposta humoral) [cite: 167]", "C: Apenas receptores da imunidade inata [cite: 99]", "D: Células NK e macrófagos apenas [cite: 403, 380]"], correct: "A" },
                { type: 'mc', q: "A estrutura básica de todos os anticorpos consiste em:", options: ["A: 2 cadeias pesadas e 2 cadeias leves [cite: 177]", "B: 1 cadeia pesada e 1 cadeia leve", "C: Apenas cadeias leves (Kappa ou Lambda) [cite: 178]", "D: Apenas cadeias pesadas (Alfa, Mi, Gama, etc) [cite: 178]"], correct: "A" },
                { type: 'mc', q: "Qual classe de anticorpo é um pentâmero na forma secretada e tem alta AVIDEZ inicial?", options: ["A: IgG [cite: 187]", "B: IgA (dímero) [cite: 187]", "C: IgE [cite: 187]", "D: IgM [cite: 187, 190]"], correct: "D" },
                { type: 'mc', q: "A porção (fragmento) do anticorpo responsável pela ligação ao antígeno é a:", options: ["A: Região Fc (constante) [cite: 181]", "B: Região Fab (variável) [cite: 180, 182]", "C: Cadeia J", "D: Peça caudal [cite: 174]"], correct: "B" },
                { type: 'mc', q: "A porção (fragmento) Fc é responsável por quais funções efetoras?", options: ["A: Apenas ligação ao antígeno [cite: 180]", "B: Ativação do complemento e ligação a receptores em fagócitos (Opsonização) [cite: 187, 192]", "C: Apenas neutralização [cite: 192]", "D: Ser um determinante conformacional [cite: 138]"], correct: "B" },
                { type: 'mc', q: "Qual isotipo de anticorpo é crucial para a imunidade de mucosas?", options: ["A: IgA [cite: 187, 195]", "B: IgD [cite: 187]", "C: IgE [cite: 187]", "D: IgG [cite: 187]"], correct: "A" },
                { type: 'mc', q: "Qual isotipo está envolvido na defesa contra parasitas helmínticos e reações de hipersensibilidade (alergia)?", options: ["A: IgA [cite: 187]", "B: IgD [cite: 187]", "C: IgE [cite: 187, 202]", "D: IgM [cite: 187]"], correct: "C" },
                { type: 'mc', q: "O mecanismo ADCC (Citotoxicidade celular dependente de anticorpo) envolve qual célula e receptor?", options: ["A: Célula NK ligando-se à porção Fc da IgG via receptor CD16 (FcγRIII) [cite: 187, 196, 197, 198]", "B: Macrófago ativando complemento [cite: 192]", "C: Linfócito T CD8+ e TCR [cite: 398]", "D: Basófilo e IgE [cite: 408, 187]"], correct: "A" },
                { type: 'mc', q: "A força de ligação de um *único* sítio Fab a um epítopo é chamada de:", options: ["A: Avidez [cite: 188, 211]", "B: Afinidade [cite: 188, 211]", "C: Imunogenicidade [cite: 140]", "D: Antigenicidade [cite: 140]"], correct: "B" }
            ],
            section6: [ // 20 Questões Abertas
                { type: 'open', q: "Explique as 4 funções principais do Sistema Imune listadas no slide 3.", keywords: ["resistência infecções", "tolerância", "rejeição transplantes", "controle tumores"] },
                { type: 'open', q: "Descreva as diferenças fundamentais entre imunidade inata e adaptativa (tempo, especificidade, memória).", keywords: ["inata constitutiva imediata", "adaptativa específica memória", "lenta", "expansão clonal"] },
                { type: 'open', q: "Diferencie imunidade ativa (natural e artificial) de imunidade passiva (natural e artificial).", keywords: ["ativa infecção imunização", "passiva gestação soros", "memória", "sem memória"] },
                { type: 'open', q: "Diferencie imunidade humoral de imunidade celular, citando as principais células envolvidas.", keywords: ["humoral B anticorpos", "celular T cooperação", "extracelular", "intracelular"] },
                { type: 'open', q: "Cite os dois órgãos linfoides primários e explique a função de cada um na maturação dos linfócitos.", keywords: ["medula óssea B", "timo T", "maturação", "geradores"] },
                { type: 'open', q: "Cite dois órgãos linfoides secundários e explique como eles filtram antígenos.", keywords: ["linfonodos linfa", "baço sangue", "secundários", "periféricos", "polpa branca"] },
                { type: 'open', q: "Qual o papel das Células Dendríticas (APCs) na ligação da imunidade inata com a adaptativa?", keywords: ["dendríticas", "apc", "apresentação", "linfócitos T", "MHC", "coestimuladores"] },
                { type: 'open', q: "Descreva as funções dos três principais granulócitos: neutrófilos, eosinófilos e basófilos.", keywords: ["neutrófilos fagocitose bactérias", "eosinófilos parasitas alergia", "basófilos alergia histamina"] },
                { type: 'open', q: "Defina Antígeno (Ag) e Epítopo (Determinante Antigênico).", keywords: ["antígeno BCR TCR", "epítopo região específica", "determinante", "ligação"] },
                { type: 'open', q: "Diferencie epítopos lineares de epítopos conformacionais.", keywords: ["linear sequência", "conformacional 3D desnaturação", "nativa", "determinante"] },
                { type: 'open', q: "Explique a diferença crucial entre antigenicidade e imunogenicidade.", keywords: ["antigenicidade ligação", "imunogenicidade induz resposta", "todos imunógenos", "nem todo antígeno"] },
                { type: 'open', q: "Cite 3 fatores que influenciam a imunogenicidade de uma molécula.", keywords: ["massa molecular", "complexidade", "distância filogenética", "dose", "via", "adjuvantes"] },
                { type: 'open', q: "Explique o que são Haptenos e como eles podem se tornar imunogênicos.", keywords: ["haptenos baixo peso", "não imunogênico", "carreador proteína", "conjugado", "níquel"] },
                { type: 'open', q: "O que são Superantígenos e por que eles causam uma ativação imune tão massiva?", keywords: ["superantígenos policlonal", "25% T", "fora sulco MHC", "toxina estafilocócica"] },
                { type: 'open', q: "Descreva a estrutura básica de um anticorpo, identificando as regiões Fab e Fc.", keywords: ["2 leves 2 pesadas", "fab variável", "antígeno", "fc constante", "efetoras"] },
                { type: 'open', q: "Cite as 5 classes (isotipos) de anticorpos e a função principal da IgA e da IgG.", keywords: ["IgA mucosa", "IgG opsonização neonatal complemento", "IgM", "IgE", "IgD"] },
                { type: 'open', q: "Explique a diferença entre Afinidade e Avidez, usando o IgM como exemplo de alta avidez.", keywords: ["afinidade um sítio", "avidez múltiplos sítios", "força total", "IgM pentâmero"] },
                { type: 'open', q: "Descreva 3 mecanismos de ação dos anticorpos (ex: neutralização, opsonização, ADCC, complemento).", keywords: ["neutralização", "opsonização fagocitose", "ADCC NK", "complemento lise"] },
                { type: 'open', q: "Explique o mecanismo de ADCC (Citotoxicidade celular dependente de anticorpo).", keywords: ["ADCC", "NK", "CD16", "FcγRIII", "IgG", "lise", "grânulos"] },
                { type: 'open', q: "Anticorpos podem causar doenças? Cite um exemplo (ex: alergia, autoimunidade).", keywords: ["alergia IgE", "autoimunes IgG", "rejeição", "MIS-C"] }
            ]
        };

        // Função para gerar perguntas aleatórias (suporte a MC e open)
        function generateQuestions(sectionId, pool) {
            // Pega 5 aleatórias para seções 1-5, ou todas (pool.length) para a seção 6
            const numToGenerate = sectionId === 'section6' ? pool.length : 5;
            const shuffled = shuffle([...pool]).slice(0, numToGenerate);
            const container = document.getElementById(`questions${sectionId.slice(-1)}`);

            shuffled.forEach((item, index) => {
                const qDiv = document.createElement('div');
                qDiv.classList.add('question');
                qDiv.dataset.type = item.type;

                const p = document.createElement('p');
                p.textContent = `${index + 1}. ${item.q}`;
                qDiv.appendChild(p);

                if (item.type === 'mc') {
                    qDiv.dataset.correct = item.correct;
                    const optionsDiv = document.createElement('div');
                    optionsDiv.classList.add('options');
                    item.options.forEach(opt => {
                        // Extrai o valor (ex: "A") e o texto (ex: "Opção A")
                        const value = opt.substring(0, opt.indexOf(':')); 
                        const btn = document.createElement('button');
                        btn.classList.add('option');
                        btn.dataset.value = value;
                        btn.textContent = opt;
                        optionsDiv.appendChild(btn);
                    });
                    qDiv.appendChild(optionsDiv);
                } else { // open
                    qDiv.dataset.keywords = item.keywords.join(',');
                    const textarea = document.createElement('textarea');
                    textarea.classList.add('open-answer');
                    textarea.placeholder = 'Digite sua resposta detalhada aqui...';
                    qDiv.appendChild(textarea);
                }
                container.appendChild(qDiv);
            });
        }

        // Gerar perguntas ao carregar
        window.addEventListener('load', () => {
            generateQuestions('section1', questionPools.section1);
            generateQuestions('section2', questionPools.section2);
            generateQuestions('section3', questionPools.section3);
            generateQuestions('section4', questionPools.section4);
            generateQuestions('section5', questionPools.section5);
            generateQuestions('section6', questionPools.section6);

            // Adicionar event listeners para seleção (MC)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('option')) {
                    const options = e.target.parentElement.querySelectorAll('.option');
                    options.forEach(opt => opt.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            });
        });

        // Função para verificar respostas (lógica do modelo fornecido)
        function checkAnswers(sectionId) {
            const section = document.getElementById(sectionId);
            const questions = section.querySelectorAll('.question');
            let correctCount = 0;
            let totalQuestions = 0;
            let errors = [];

            questions.forEach((q, index) => {
                totalQuestions++;
                if (q.dataset.type === 'mc') {
                    const selected = q.querySelector('.option.selected');
                    const correct = q.dataset.correct;
                    if (selected && selected.dataset.value === correct) {
                        correctCount++;
                    } else {
                        const questionText = q.querySelector('p').textContent;
                        const selectedValue = selected ? selected.textContent : 'Nenhuma selecionada';
                        const correctOptionElement = Array.from(q.querySelectorAll('.option')).find(opt => opt.dataset.value === correct);
                        const correctText = correctOptionElement ? correctOptionElement.textContent : 'N/A';
                        errors.push(`${questionText} - Sua resposta: ${selectedValue} (Errada). Correta: ${correctText}`);
                    }
                } else { // open
                    const answer = q.querySelector('.open-answer').value.toLowerCase().trim();
                    const keywords = q.dataset.keywords.split(',').map(k => k.toLowerCase().trim());
                    // Critério de correção parcial: pelo menos 2 keywords
                    const matches = keywords.filter(kw => answer.includes(kw)).length;
                    if (matches >= 2) { 
                        correctCount++;
                    } else {
                        const questionText = q.querySelector('p').textContent;
                        errors.push(`${questionText} - Resposta parcial/errada. Sugestão: Inclua termos como ${keywords.slice(0,3).join(', ')}...`);
                    }
                }
            });

            const feedback = document.getElementById(`feedback${sectionId.slice(-1)}`);
            feedback.innerHTML = `<span class="${correctCount === totalQuestions ? 'correct' : 'incorrect'}">Você acertou ${correctCount} de ${totalQuestions} questões.</span>`;

            const result = document.getElementById(`result${sectionId.slice(-1)}`);
            result.style.display = 'block';
            if (errors.length === 0) {
                result.innerHTML = '<p class="correct">Todas corretas! Parabéns!</p>';
            } else {
                result.innerHTML = '<h3>Erros Detalhados:</h3><ul>' + errors.map(err => `<li>${err}</li>`).join('') + '</ul>';
            }
        }
    </script>
</body>
</html>
