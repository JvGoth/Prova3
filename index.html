<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Interativo de Genética Médica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        #timer {
            text-align: center;
            font-size: 24px;
            color: #e74c3c;
            margin-bottom: 20px;
        }
        .section {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 20px;
            max-width: 800px;
        }
        .question {
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        .question p {
            font-weight: bold;
        }
        .options {
            display: flex;
            flex-direction: column;
        }
        .option {
            background-color: #e7e7e7;
            border: none;
            border-radius: 4px;
            color: #333;
            cursor: pointer;
            margin: 5px 0;
            padding: 10px;
            text-align: left;
            transition: background-color 0.3s;
        }
        .option:hover {
            background-color: #d0d0d0;
        }
        .option.selected {
            background-color: #3498db;
            color: #fff;
        }
        .open-answer {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin: 5px 0;
            font-family: Arial, sans-serif;
            box-sizing: border-box; /* Garante que o padding não estoure a largura */
        }
        .submit-btn {
            background-color: #27ae60;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            display: block;
            font-size: 16px;
            margin: 20px auto 0;
            padding: 10px 20px;
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #219653;
        }
        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .feedback {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
        }
        .correct {
            color: #27ae60;
        }
        .incorrect {
            color: #e74c3c;
        }
        .result {
            background-color: #ecf0f1;
            border-radius: 4px;
            margin-top: 20px;
            padding: 10px;
        }
        .result ul {
            list-style-type: none;
            padding: 0;
        }
        .result li {
            margin: 10px 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Quiz Interativo de Genética Médica</h1>
    <p style="text-align: center;">Este site contém questões interativas sobre Genética Médica baseadas nas aulas fornecidas. Selecione respostas para cada seção e clique em "Verificar". A seção final contém 15 questões abertas com contexto dos slides.</p>
    <div id="timer">Tempo restante: 01:30:00</div>

    <div class="section" id="section1">
        <h2>Introdução à Genética</h2>
        <div id="questions1"></div>
        <button class="submit-btn" onclick="checkAnswers('section1')">Verificar Respostas</button>
        <div class="feedback" id="feedback1"></div>
        <div class="result" id="result1" style="display: none;"></div>
    </div>

    <div class="section" id="section2">
        <h2>Histórico da Genética</h2>
        <div id="questions2"></div>
        <button class="submit-btn" onclick="checkAnswers('section2')">Verificar Respostas</button>
        <div class="feedback" id="feedback2"></div>
        <div class="result" id="result2" style="display: none;"></div>
    </div>

    <div class="section" id="section3">
        <h2>Genética Mendeliana</h2>
        <div id="questions3"></div>
        <button class="submit-btn" onclick="checkAnswers('section3')">Verificar Respostas</button>
        <div class="feedback" id="feedback3"></div>
        <div class="result" id="result3" style="display: none;"></div>
    </div>

    <div class="section" id="section4">
        <h2>Extensões da Análise Mendeliana</h2>
        <div id="questions4"></div>
        <button class="submit-btn" onclick="checkAnswers('section4')">Verificar Respostas</button>
        <div class="feedback" id="feedback4"></div>
        <div class="result" id="result4" style="display: none;"></div>
    </div>

    <div class="section" id="section5">
        <h2>Análise de Heredogramas</h2>
        <div id="questions5"></div>
        <button class="submit-btn" onclick="checkAnswers('section5')">Verificar Respostas</button>
        <div class="feedback" id="feedback5"></div>
        <div class="result" id="result5" style="display: none;"></div>
    </div>

    <div class="section" id="section6">
        <h2>Questões Abertas (Nível Avançado)</h2>
        <p>Responda livremente nas caixas de texto com base no contexto fornecido. Verificação parcial baseada em palavras-chave.</p>
        <div id="questions6"></div>
        <button class="submit-btn" onclick="checkAnswers('section6')">Verificar Respostas</button>
        <div class="feedback" id="feedback6"></div>
        <div class="result" id="result6" style="display: none;"></div>
    </div>

    <script>
        // Função para embaralhar array (Fisher-Yates shuffle)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Pools de Perguntas de Genética Médica (baseado nos PDFs)
        // NOTA: Removidos os prefixos "A:", "B:" para permitir embaralhamento real das letras
        const questionPools = {
            section1: [ // Introdução à Genética
                { type: 'mc', q: "O que a genética estuda, segundo a aula?", options: ["Todos os aspectos dos genes, unidades fundamentais da informação biológica", "Apenas estrutura celular", "Apenas evolução animal", "Apenas doenças infecciosas"], correctText: "Todos os aspectos dos genes, unidades fundamentais da informação biológica" },
                { type: 'mc', q: "Como a genética pode ser subdividida?", options: ["Genética de Transmissão, Molecular e de Populações", "Apenas Genética Molecular", "Apenas Genética de Populações", "Genética de Plantas e Animais"], correctText: "Genética de Transmissão, Molecular e de Populações" },
                { type: 'mc', q: "Qual a importância da genética na sociedade moderna?", options: ["Influencia susceptibilidade a doenças, características físicas, personalidade, etc.", "Apenas na agricultura", "Apenas em animais", "Nenhum impacto"], correctText: "Influencia susceptibilidade a doenças, características físicas, personalidade, etc." },
                { type: 'mc', q: "Os princípios genéticos foram usados há milhares de anos para:", options: ["Domesticação de plantas e animais", "Construção de pirâmides", "Navegação marítima", "Pintura rupestre"], correctText: "Domesticação de plantas e animais" },
                { type: 'mc', q: "Qual estrutura armazena a informação biológica?", options: ["DNA organizado em genes e cromossomos", "RNA apenas", "Proteínas isoladas", "Lipídios"], correctText: "DNA organizado em genes e cromossomos" },
                { type: 'mc', q: "Os nucleotídeos do DNA são constituídos de quantas partes?", options: ["3 partes", "2 partes", "4 partes", "1 parte"], correctText: "3 partes" },
                { type: 'mc', q: "Genes são segmentos de cromossomo que contêm informação para:", options: ["Polipeptídeos funcionais ou moléculas de RNA", "Apenas carboidratos", "Apenas lipídios", "Nada"], correctText: "Polipeptídeos funcionais ou moléculas de RNA" },
                { type: 'mc', q: "O DNA é compactado com:", options: ["Proteínas", "Água", "Minerais", "Vitaminas"], correctText: "Proteínas" },
                { type: 'mc', q: "Qual é o pareamento de bases no DNA?", options: ["A=T e C≡G", "A=C e T=G", "A=G e T=C", "Nenhum pareamento"], correctText: "A=T e C≡G" },
                { type: 'mc', q: "Qual é o código de inscrição no Moodle para a disciplina?", options: ["IBTEC39306", "GENMED2025", "UFU123", "BIOTEC456"], correctText: "IBTEC39306" }
            ],
            section2: [ // Histórico da Genética
                { type: 'mc', q: "Quem introduziu o conceito de pangênese?", options: ["Hipócrates de Cos", "Aristóteles", "Gregor Mendel", "James Watson"], correctText: "Hipócrates de Cos" },
                { type: 'mc', q: "O conceito de pangênese levou à noção de:", options: ["Herança de caracteres adquiridos", "Teoria do germoplasma", "Estrutura do DNA", "Codominância"], correctText: "Herança de caracteres adquiridos" },
                { type: 'mc', q: "Aristóteles rejeitou o conceito de pangênese porque:", options: ["Partes amputadas não eram herdadas e semelhança com ancestrais ausentes nos pais", "Acreditava em herança apenas materna", "Não acreditava em herança", "Apenas estudava plantas"], correctText: "Partes amputadas não eram herdadas e semelhança com ancestrais ausentes nos pais" },
                { type: 'mc', q: "Segundo Aristóteles, a fêmea fornece a:", options: ["Matéria básica", "Essência", "Apenas alma", "Nada"], correctText: "Matéria básica" },
                { type: 'mc', q: "Quem publicou 'Experimentos sobre a hibridização de plantas' em 1866?", options: ["Gregor Mendel", "Charles Darwin", "James Watson", "Rosalind Franklin"], correctText: "Gregor Mendel" },
                { type: 'mc', q: "Mendel conduziu experimentos de cruzamento de:", options: ["1856 até 1863", "1900 até 1910", "1700 até 1750", "2000 até 2010"], correctText: "1856 até 1863" },
                { type: 'mc', q: "Quem descobriu a estrutura do DNA em 1953?", options: ["James Watson e Francis Crick", "Gregor Mendel", "Aristóteles", "Hipócrates"], correctText: "James Watson e Francis Crick" },
                { type: 'mc', q: "O Talmund compreendia sobre a:", options: ["Hemofilia", "Diabetes", "Câncer", "Gripe"], correctText: "Hemofilia" },
                { type: 'mc', q: "A polinização de plantas foi registrada em escultura de:", options: ["883 a 859 a.C.", "2000 a.C.", "1953", "1866"], correctText: "883 a 859 a.C." },
                { type: 'mc', q: "Qual teoria veio no final do século XIX?", options: ["Teoria do germoplasma (Weismann)", "Pangênese", "Estrutura do DNA", "Codominância"], correctText: "Teoria do germoplasma (Weismann)" }
            ],
            section3: [ // Genética Mendeliana
                { type: 'mc', q: "Qual o início da Genética Moderna?", options: ["1900, com o trabalho de Mendel", "1953, estrutura do DNA", "1866, publicação de Mendel", "460 a.C., Hipócrates"], correctText: "1900, com o trabalho de Mendel" },
                { type: 'mc', q: "Mendel era contemporâneo de:", options: ["Charles Darwin", "James Watson", "Aristóteles", "Weismann"], correctText: "Charles Darwin" },
                { type: 'mc', q: "Mendel publicou sobre hibridização de plantas em:", options: ["1866", "1953", "1900", "1859"], correctText: "1866" },
                { type: 'mc', q: "Qual o monastério de Mendel?", options: ["O monastério onde conduziu experimentos", "Um laboratório moderno", "Uma universidade", "Nenhum"], correctText: "O monastério onde conduziu experimentos" },
                { type: 'mc', q: "Mendel não sabia o que eram genes ou:", options: ["Como eram herdados em nível celular", "Sobre DNA", "Sobre proteínas", "Sobre RNA"], correctText: "Como eram herdados em nível celular" },
                { type: 'mc', q: "Qual o conceito rejeitado por Aristóteles na hereditariedade?", options: ["Pangênese", "Germoplasma", "DNA", "Codominância"], correctText: "Pangênese" },
                { type: 'mc', q: "Hipócrates acreditava em:", options: ["Pangênese", "Competição entre sêmen", "Essência masculina", "Matéria feminina"], correctText: "Pangênese" },
                { type: 'mc', q: "A teoria do germoplasma foi proposta por:", options: ["Weismann", "Mendel", "Darwin", "Watson"], correctText: "Weismann" },
                { type: 'mc', q: "Escritos sagrados Indus atribuíam características a:", options: ["Pais e diferenças entre irmãos à mãe", "Apenas pai", "Apenas mãe", "Ancestrais distantes"], correctText: "Pais e diferenças entre irmãos à mãe" },
                { type: 'mc', q: "O Talmund menciona:", options: ["Hemofilia e circuncisão", "Polinização", "DNA", "Câncer"], correctText: "Hemofilia e circuncisão" }
            ],
            section4: [ // Extensões da Análise Mendeliana
                { type: 'mc', q: "Na dominância incompleta, o heterozigoto fica:", options: ["Entre os fenótipos dos dois homozigotos", "Igual ao dominante", "Igual ao recessivo", "Novo fenótipo"], correctText: "Entre os fenótipos dos dois homozigotos" },
                { type: 'mc', q: "Exemplo de dominância incompleta nos slides:", options: ["Frutos púrpura, violeta e branco", "Grupos sanguíneos", "Hemofilia", "Cor de pele"], correctText: "Frutos púrpura, violeta e branco" },
                { type: 'mc', q: "Proporção genotípica na dominância incompleta:", options: ["1:2:1", "3:1", "9:3:3:1", "1:1"], correctText: "1:2:1" },
                { type: 'mc', q: "Na codominância, o fenótipo do heterozigoto inclui:", options: ["Fenótipos dos dois homozigotos", "Apenas um fenótipo", "Nenhum fenótipo", "Fenótipo intermediário"], correctText: "Fenótipos dos dois homozigotos" },
                { type: 'mc', q: "Quais extensões à análise mendeliana foram descobertas?", options: ["Dominância incompleta, codominância, múltiplos alelos, etc.", "Apenas pangênese", "Apenas germoplasma", "Nada"], correctText: "Dominância incompleta, codominância, múltiplos alelos, etc." },
                { type: 'mc', q: "A dominância incompleta não afeta:", options: ["O modo que os genes são herdados", "A herança celular", "A estrutura do DNA", "A compactação"], correctText: "O modo que os genes são herdados" },
                { type: 'mc', q: "Conceitos de penetrância e expressividade são:", options: ["Extensões modernas da genética", "Princípios básicos de Mendel", "Histórico antigo", "Apenas em plantas"], correctText: "Extensões modernas da genética" },
                { type: 'mc', q: "Alelos letais são um exemplo de:", options: ["Extensão mendeliana", "Pangênese", "Germoplasma", "DNA"], correctText: "Extensão mendeliana" },
                { type: 'mc', q: "Interação gênica inclui:", options: ["Epistasia", "Apenas dominância completa", "Apenas recessividade", "Nada"], correctText: "Epistasia" },
                { type: 'mc', q: "O trabalho de Mendel ganhou visibilidade e foi confirmado em:", options: ["Diversos organismos", "Apenas ervilhas", "Apenas humanos", "Nenhum"], correctText: "Diversos organismos" }
            ],
            section5: [ // Análise de Heredogramas
                { type: 'mc', q: "Um heredograma é uma representação gráfica de:", options: ["História familiar mostrando herança de características", "Estrutura do DNA", "Compactação proteica", "Polinização"], correctText: "História familiar mostrando herança de características" },
                { type: 'mc', q: "Humano é o melhor e pior organismo para estudos genéticos porque:", options: ["Não são possíveis reproduções controladas e prole pequena", "Tempo de geração curto", "Reproduções fáceis", "Prole grande"], correctText: "Não são possíveis reproduções controladas e prole pequena" },
                { type: 'mc', q: "O probando (P) é:", options: ["A pessoa a partir da qual o heredograma é iniciado", "Um alelo recessivo", "Um gene dominante", "Um cromossomo"], correctText: "A pessoa a partir da qual o heredograma é iniciado" },
                { type: 'mc', q: "Características autossômicas recessivas incluem exemplos como:", options: ["PKU e fibrose cística", "Síndrome de Waardenburg", "Acondroplasia", "Hemofilia"], correctText: "PKU e fibrose cística" },
                { type: 'mc', q: "Características autossômicas dominantes incluem:", options: ["Acondroplasia (interfere no crescimento dos ossos)", "PKU", "Fibrose cística", "Hemofilia"], correctText: "Acondroplasia (interfere no crescimento dos ossos)" },
                { type: 'mc', q: "Na análise de risco, se ambos pais são heterozigotos para recessivo raro, probabilidade de filho afetado é:", options: ["1/4", "1/2", "3/4", "1"], correctText: "1/4" },
                { type: 'mc', q: "Símbolo para pessoa não afetada em heredograma:", options: ["Quadrado ou círculo vazio", "Quadrado ou círculo preenchido", "Diamante", "Número"], correctText: "Quadrado ou círculo vazio" },
                { type: 'mc', q: "Síndrome de Waardenburg é herdada como:", options: ["Traço autossômico dominante", "Recessivo", "Ligado ao X", "Mitocondrial"], correctText: "Traço autossômico dominante" },
                { type: 'mc', q: "Caracterizada por surdez, pele clara, problemas visuais e topete branco:", options: ["Síndrome de Waardenburg", "PKU", "Fibrose cística", "Hemofilia"], correctText: "Síndrome de Waardenburg" },
                { type: 'mc', q: "Em heredogramas, múltiplas pessoas (5) são representadas por:", options: ["Número 5", "Quadrado preenchido", "Linha diagonal", "Nada"], correctText: "Número 5" }
            ],
            section6: [ // 15 Questões Abertas
                { type: 'open', q: "Baseado na introdução, defina o que a genética estuda e como ela pode ser subdividida.", keywords: ["aspectos genes", "unidades informação biológica", "transmissão molecular populações"] },
                { type: 'open', q: "No histórico, explique o conceito de pangênese proposto por Hipócrates e sua influência.", keywords: ["partículas precursoras", "herança adquiridos", "influente até 1800"] },
                { type: 'open', q: "Com base nos slides de Aristóteles, descreva por que ele rejeitou a pangênese e sua visão sobre contribuições dos pais.", keywords: ["duas cabeças", "partes amputadas não herdadas", "fêmea matéria macho essência"] },
                { type: 'open', q: "No contexto do histórico, discuta o trabalho de Mendel e seu impacto na genética moderna.", keywords: ["experimentos hibridização", "1866 princípios hereditariedade", "início 1900"] },
                { type: 'open', q: "Baseado na estrutura do DNA, explique os elementos estruturais e o pareamento de bases.", keywords: ["nucleotídeos 3 partes", "a=t c=g", "fitas anti-paralelas"] },
                { type: 'open', q: "No slide sobre DNA a proteína, descreva o processo de transcrição e tradução.", keywords: ["dna rna proteína", "transcrição tradução", "genes polipeptídeos rna"] },
                { type: 'open', q: "Com base na genética na mídia, cite e explique um exemplo de doença genética mencionado (ex: trissomia 13).", keywords: ["síndrome patau", "trissomia cromossomo 13", "genética rara grave"] },
                { type: 'open', q: "Explique o fenômeno dos alelos letais com base no exemplo dos camundongos amarelos e justifique por que a proporção fenotípica observada na prole é de 2:1 ao invés de 3:1.", keywords: ["homozigoto morre", "embrião", "letal recessivo", "desenvolvimento", "2:1"] },
                { type: 'open', q: "Baseado nas extensões mendelianas, explique dominância incompleta com o exemplo dos frutos.", keywords: ["heterozigoto intermediário", "púrpura violeta branco", "1:2:1"] },
                { type: 'open', q: "No contexto de codominância, descreva o fenótipo do heterozigoto e dê um exemplo.", keywords: ["ambos fenótipos homozigotos", "grupos sanguíneos ab", "não intermediário"] },
                { type: 'open', q: "Com base na análise de heredogramas, explique o que é um heredograma e suas limitações em humanos.", keywords: ["representação gráfica história familiar", "reproduções não controladas", "prole pequena"] },
                { type: 'open', q: "No slide de símbolos de heredogramas, descreva os símbolos para afetado, não afetado e sexo desconhecido.", keywords: ["preenchido afetado", "vazio não afetado", "diamante desconhecido"] },
                { type: 'open', q: "Baseado em características autossômicas recessivas, cite exemplos e padrões em heredogramas.", keywords: ["pku fibrose cística", "pula gerações", "consanguinidade"] },
                { type: 'open', q: "No exemplo de análise de risco, calcule a probabilidade para um casal com tios afetados por recessivo raro.", keywords: ["ambos heterozigotos", "1/4 filho afetado", "alelo raro"] },
                { type: 'open', q: "Com base nos exercícios propostos, explique o modo de herança para braquidactilia no heredograma de Maria.", keywords: ["autossômico dominante", "dedos curtos", "probabilidade 1/2"] }
            ]
        };

        // Função para gerar perguntas aleatórias
        function generateQuestions(sectionId, pool) {
            const numToGenerate = sectionId === 'section6' ? pool.length : 5;
            const shuffledQuestions = shuffle([...pool]).slice(0, numToGenerate);
            const container = document.getElementById(`questions${sectionId.slice(-1)}`);
            
            const alphabet = ['A', 'B', 'C', 'D'];
            
            shuffledQuestions.forEach((item, index) => {
                const qDiv = document.createElement('div');
                qDiv.classList.add('question');
                qDiv.dataset.type = item.type;
                
                const p = document.createElement('p');
                p.textContent = `${index + 1}. ${item.q}`;
                qDiv.appendChild(p);
                
                if (item.type === 'mc') {
                    // 1. Embaralha as opções puras
                    let optionsToShuffle = [...item.options];
                    shuffle(optionsToShuffle);
                    
                    // 2. Encontra a nova letra correta após o embaralhamento
                    let newCorrectLetter = '';
                    const optionsDiv = document.createElement('div');
                    optionsDiv.classList.add('options');
                    
                    optionsToShuffle.forEach((opt, optIndex) => {
                        const newLetter = alphabet[optIndex]; // A, B, C ou D da nova posição
                        
                        // Verifica se esta opção é a correta comparando o texto
                        const isCorrect = opt === item.correctText;
                        if (isCorrect) {
                            newCorrectLetter = newLetter;
                        }
                        
                        // Cria o texto da opção com o prefixo da letra
                        const newOptionText = `${newLetter}: ${opt}`;
                        
                        const btn = document.createElement('button');
                        btn.classList.add('option');
                        btn.dataset.value = newLetter; // Armazena a nova letra (A, B, C ou D)
                        btn.textContent = newOptionText;
                        optionsDiv.appendChild(btn);
                    });
                    
                    // 3. Define a nova letra correta no dataset da questão
                    qDiv.dataset.correct = newCorrectLetter;
                    qDiv.appendChild(optionsDiv);
                } else { // open
                    qDiv.dataset.keywords = item.keywords.join(',');
                    const textarea = document.createElement('textarea');
                    textarea.classList.add('open-answer');
                    textarea.placeholder = 'Digite sua resposta detalhada aqui...';
                    qDiv.appendChild(textarea);
                }
                container.appendChild(qDiv);
            });
        }

        // Timer global
        let timeLeft = 5400; // Tempo total em segundos (90 min)
        const timerDisplay = document.getElementById('timer');
        let timerInterval;

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const hours = Math.floor(timeLeft / 3600);
                const minutes = Math.floor((timeLeft % 3600) / 60);
                const seconds = timeLeft % 60;
                
                const formattedTime = 
                    `${hours < 10 ? '0' : ''}${hours}:` +
                    `${minutes < 10 ? '0' : ''}${minutes}:` +
                    `${seconds < 10 ? '0' : ''}${seconds}`;
                
                timerDisplay.textContent = `Tempo restante: ${formattedTime}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = 'Tempo esgotado!';
                    document.querySelectorAll('.submit-btn').forEach(btn => btn.disabled = true);
                }
            }, 1000);
        }

        window.addEventListener('load', () => {
            generateQuestions('section1', questionPools.section1);
            generateQuestions('section2', questionPools.section2);
            generateQuestions('section3', questionPools.section3);
            generateQuestions('section4', questionPools.section4);
            generateQuestions('section5', questionPools.section5);
            generateQuestions('section6', questionPools.section6);
            
            startTimer();

            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('option')) {
                    const options = e.target.parentElement.querySelectorAll('.option');
                    options.forEach(opt => opt.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            });
        });

        function checkAnswers(sectionId) {
            if (timeLeft <= 0) return;
            
            const section = document.getElementById(sectionId);
            const questions = section.querySelectorAll('.question');
            let correctCount = 0;
            let totalQuestions = 0;
            let errors = [];

            questions.forEach((q) => {
                totalQuestions++;
                if (q.dataset.type === 'mc') {
                    const selected = q.querySelector('.option.selected');
                    const correct = q.dataset.correct;
                    
                    if (selected && selected.dataset.value === correct) {
                        correctCount++;
                    } else {
                        const questionText = q.querySelector('p').textContent;
                        const selectedValue = selected ? selected.textContent : 'Nenhuma selecionada';
                        
                        // Encontra o botão que tem a letra correta para mostrar no feedback
                        const correctBtn = Array.from(q.querySelectorAll('.option')).find(btn => btn.dataset.value === correct);
                        const correctText = correctBtn ? correctBtn.textContent : 'Erro interno';
                        
                        errors.push(`${questionText}<br><strong>Sua resposta:</strong> ${selectedValue} (Incorreta)<br><strong>Correta:</strong> <span class='correct'>${correctText}</span>`);
                    }
                } else { // open
                    const answer = q.querySelector('.open-answer').value.toLowerCase().trim();
                    const keywords = q.dataset.keywords.split(',').map(k => k.toLowerCase().trim());
                    const matches = keywords.filter(kw => answer.includes(kw)).length;
                    
                    if (matches >= 2) {
                        correctCount++;
                    } else {
                        const questionText = q.querySelector('p').textContent;
                        errors.push(`${questionText}<br>Resposta incompleta ou incorreta. Tente incluir conceitos como: <em>${keywords.slice(0,3).join(', ')}</em>`);
                    }
                }
            });

            const feedback = document.getElementById(`feedback${sectionId.slice(-1)}`);
            feedback.innerHTML = `<span class="${correctCount === totalQuestions ? 'correct' : 'incorrect'}">Você acertou ${correctCount} de ${totalQuestions} questões.</span>`;
            
            const result = document.getElementById(`result${sectionId.slice(-1)}`);
            result.style.display = 'block';
            
            if (errors.length === 0) {
                result.innerHTML = '<p class="correct"><strong>Todas corretas! Parabéns!</strong></p>';
            } else {
                result.innerHTML = '<h3>Relatório de Erros:</h3><ul>' + errors.map(err => `<li>${err}</li>`).join('') + '</ul>';
            }
        }
    </script>
</body>
</html>
